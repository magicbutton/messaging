<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Magic Button Messaging - v1.0.7</title><meta name="description" content="Documentation for Magic Button Messaging"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">Magic Button Messaging - v1.0.7</a><div id="tsd-toolbar-links"><a href="https://github.com/magicbutton.cloud/messaging">GitHub</a><a href="https://code.magicbutton.cloud">Documentation</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>Magic Button Messaging - v1.0.7</h1></div><div class="tsd-panel tsd-typography"><h1 id="magic-button-messaging" class="tsd-anchor-link">Magic Button Messaging<a href="#magic-button-messaging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A type-safe, domain-driven design framework for distributed systems communication. Magic Button Messaging provides a robust foundation for building scalable, maintainable, and secure communication between distributed system components.</p>
<p><img src="https://via.placeholder.com/800x400?text=Magic+Button+Messaging" alt="Magic Button Messaging"></p>
<h2 id="table-of-contents" class="tsd-anchor-link">Table of Contents<a href="#table-of-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="#features">Features</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a>
<ul>
<li><a href="#contracts">Contracts</a></li>
<li><a href="#transport-adapters">Transport Adapters</a></li>
<li><a href="#client-and-server">Client and Server</a></li>
<li><a href="#access-control">Access Control</a></li>
<li><a href="#message-context">Message Context</a></li>
</ul>
</li>
<li><a href="#api-reference">API Reference</a></li>
<li><a href="#examples">Examples</a>
<ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#custom-transport">Custom Transport</a></li>
<li><a href="#access-control-example">Access Control</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#react-integration">React Integration</a></li>
</ul>
</li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id="features" class="tsd-anchor-link">Features<a href="#features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Contract-First Design</strong>: Define your communication contracts with Zod schemas for complete type safety</li>
<li><strong>Pluggable Transport Layer</strong>: Use built-in transports or create your own (HTTP, WebSockets, MQTT, etc.)</li>
<li><strong>Middleware Pipeline</strong>: Insert middleware for logging, authentication, validation, and more</li>
<li><strong>Access Control</strong>: Built-in role-based access control for secure communication</li>
<li><strong>Type Safety</strong>: Full TypeScript support with inferred types from your Zod schemas</li>
<li><strong>Client/Server Architecture</strong>: Dedicated client and server classes for easy implementation</li>
<li><strong>Event-Driven Communication</strong>: Support for both request/response and event-based communication patterns</li>
<li><strong>Context Propagation</strong>: Pass context information (auth, tracing, etc.) through your communication chain</li>
</ul>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0"># Using npm</span><br/><span class="hl-1">npm</span><span class="hl-2"> </span><span class="hl-3">install</span><span class="hl-2"> </span><span class="hl-3">@magicbutton.cloud/messaging</span><br/><br/><span class="hl-0"># Using yarn</span><br/><span class="hl-1">yarn</span><span class="hl-2"> </span><span class="hl-3">add</span><span class="hl-2"> </span><span class="hl-3">@magicbutton.cloud/messaging</span><br/><br/><span class="hl-0"># Using pnpm</span><br/><span class="hl-1">pnpm</span><span class="hl-2"> </span><span class="hl-3">add</span><span class="hl-2"> </span><span class="hl-3">@magicbutton.cloud/messaging</span>
</code><button type="button">Copy</button></pre>

<h2 id="quick-start" class="tsd-anchor-link">Quick Start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="define-your-contract" class="tsd-anchor-link">Define Your Contract<a href="#define-your-contract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> </span><span class="hl-5">*</span><span class="hl-2"> </span><span class="hl-4">as</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2"> </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;zod&quot;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">createContract</span><span class="hl-2">, </span><span class="hl-6">createEventMap</span><span class="hl-2">, </span><span class="hl-6">createRequestSchemaMap</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Define event schemas</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">events</span><span class="hl-2"> = </span><span class="hl-1">createEventMap</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">userCreated:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">email</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">createdAt:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">  </span><span class="hl-6">userUpdated:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">email</span><span class="hl-2">().</span><span class="hl-1">optional</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">optional</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">updatedAt:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Define request/response schemas</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">requests</span><span class="hl-2"> = </span><span class="hl-1">createRequestSchemaMap</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">getUserById:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">requestSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-6">responseSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">email</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">nullable</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">createdAt:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-6">createUser:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">requestSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">email</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">optional</span><span class="hl-2">(),</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-6">responseSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">email</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">nullable</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">createdAt:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Define error codes</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">errors</span><span class="hl-2"> = {</span><br/><span class="hl-2">  </span><span class="hl-6">USER_NOT_FOUND:</span><span class="hl-2"> { </span><span class="hl-6">code:</span><span class="hl-2"> </span><span class="hl-3">&quot;USER_NOT_FOUND&quot;</span><span class="hl-2">, </span><span class="hl-6">message:</span><span class="hl-2"> </span><span class="hl-3">&quot;User not found&quot;</span><span class="hl-2">, </span><span class="hl-6">status:</span><span class="hl-2"> </span><span class="hl-8">404</span><span class="hl-2"> },</span><br/><span class="hl-2">  </span><span class="hl-6">INVALID_EMAIL:</span><span class="hl-2"> { </span><span class="hl-6">code:</span><span class="hl-2"> </span><span class="hl-3">&quot;INVALID_EMAIL&quot;</span><span class="hl-2">, </span><span class="hl-6">message:</span><span class="hl-2"> </span><span class="hl-3">&quot;Invalid email format&quot;</span><span class="hl-2">, </span><span class="hl-6">status:</span><span class="hl-2"> </span><span class="hl-8">400</span><span class="hl-2"> },</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Create the contract</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">userServiceContract</span><span class="hl-2"> = </span><span class="hl-1">createContract</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">events</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">requests</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-4">export</span><span class="hl-2"> </span><span class="hl-5">type</span><span class="hl-2"> </span><span class="hl-9">UserServiceContract</span><span class="hl-2"> = </span><span class="hl-5">typeof</span><span class="hl-2"> </span><span class="hl-6">userServiceContract</span>
</code><button type="button">Copy</button></pre>

<h3 id="server-implementation" class="tsd-anchor-link">Server Implementation<a href="#server-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">Server</span><span class="hl-2">, </span><span class="hl-6">InMemoryTransport</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">userServiceContract</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;./contract&quot;</span><br/><br/><span class="hl-0">// Create a server with the in-memory transport</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">transport</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">InMemoryTransport</span><span class="hl-2">()</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">server</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Server</span><span class="hl-2">(</span><span class="hl-6">transport</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Start the server</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">start</span><span class="hl-2">(</span><span class="hl-3">&quot;memory://user-service&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Handle the getUserById request</span><br/><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">handleRequest</span><span class="hl-2">(</span><span class="hl-3">&quot;getUserById&quot;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-6">payload</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">, </span><span class="hl-6">clientId</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">id</span><span class="hl-2"> } = </span><span class="hl-6">payload</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Simulate database lookup</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-6">users</span><span class="hl-2">.</span><span class="hl-1">find</span><span class="hl-2">(</span><span class="hl-6">u</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-6">u</span><span class="hl-2">.</span><span class="hl-6">id</span><span class="hl-2"> === </span><span class="hl-6">id</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-6">user</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-4">throw</span><span class="hl-2"> </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-3">&quot;USER_NOT_FOUND&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-6">user</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Handle the createUser request</span><br/><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">handleRequest</span><span class="hl-2">(</span><span class="hl-3">&quot;createUser&quot;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-6">payload</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">, </span><span class="hl-6">clientId</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">email</span><span class="hl-2">, </span><span class="hl-7">name</span><span class="hl-2"> } = </span><span class="hl-6">payload</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Create a new user</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">crypto</span><span class="hl-2">.</span><span class="hl-1">randomUUID</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">email</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-6">name</span><span class="hl-2"> || </span><span class="hl-5">null</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">createdAt:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Save the user</span><br/><span class="hl-2">  </span><span class="hl-6">users</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><span class="hl-6">user</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Emit userCreated event</span><br/><span class="hl-2">  </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">broadcast</span><span class="hl-2">(</span><span class="hl-3">&quot;userCreated&quot;</span><span class="hl-2">, </span><span class="hl-6">user</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-6">user</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&quot;User service running on memory://user-service&quot;</span><span class="hl-2">)</span>
</code><button type="button">Copy</button></pre>

<h3 id="client-implementation" class="tsd-anchor-link">Client Implementation<a href="#client-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">Client</span><span class="hl-2">, </span><span class="hl-6">InMemoryTransport</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">userServiceContract</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;./contract&quot;</span><br/><br/><span class="hl-0">// Create a client with the in-memory transport</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">transport</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">InMemoryTransport</span><span class="hl-2">()</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Client</span><span class="hl-2">(</span><span class="hl-6">transport</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">clientId:</span><span class="hl-2"> </span><span class="hl-3">&quot;admin-client&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">clientType:</span><span class="hl-2"> </span><span class="hl-3">&quot;admin&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Connect to the server</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">connect</span><span class="hl-2">(</span><span class="hl-3">&quot;memory://user-service&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Subscribe to events</span><br/><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">on</span><span class="hl-2">(</span><span class="hl-3">&quot;userCreated&quot;</span><span class="hl-2">, (</span><span class="hl-6">payload</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&quot;New user created:&quot;</span><span class="hl-2">, </span><span class="hl-6">payload</span><span class="hl-2">)</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Send a request to create a user</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">newUser</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;createUser&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-3">&quot;john@example.com&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;John Doe&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&quot;Created user:&quot;</span><span class="hl-2">, </span><span class="hl-6">newUser</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Send a request to get a user</span><br/><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;getUserById&quot;</span><span class="hl-2">, { </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">newUser</span><span class="hl-2">.</span><span class="hl-6">id</span><span class="hl-2"> })</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&quot;Retrieved user:&quot;</span><span class="hl-2">, </span><span class="hl-6">user</span><span class="hl-2">)</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-3">&quot;Error retrieving user:&quot;</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2">)</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="core-concepts" class="tsd-anchor-link">Core Concepts<a href="#core-concepts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="contracts" class="tsd-anchor-link">Contracts<a href="#contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Contracts define the shape of your communication. They consist of:</p>
<ul>
<li><strong>Events</strong>: One-way messages published by services</li>
<li><strong>Requests</strong>: Request/response pairs for service-to-service communication</li>
<li><strong>Errors</strong>: Standardized error codes and messages</li>
</ul>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> </span><span class="hl-5">*</span><span class="hl-2"> </span><span class="hl-4">as</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2"> </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;zod&quot;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">createContract</span><span class="hl-2">, </span><span class="hl-6">createEventMap</span><span class="hl-2">, </span><span class="hl-6">createRequestSchemaMap</span><span class="hl-2">, </span><span class="hl-6">createErrorMap</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Define events</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">events</span><span class="hl-2"> = </span><span class="hl-1">createEventMap</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">orderCreated:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">orderId:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">customerId:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">amount:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">    </span><span class="hl-6">timestamp:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Define requests</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">requests</span><span class="hl-2"> = </span><span class="hl-1">createRequestSchemaMap</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">getOrderDetails:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">requestSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">orderId:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-6">responseSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">orderId:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">customerId:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">items:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">array</span><span class="hl-2">(</span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">        </span><span class="hl-6">productId:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">        </span><span class="hl-6">quantity:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">        </span><span class="hl-6">price:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">      })),</span><br/><span class="hl-2">      </span><span class="hl-6">total:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">status:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">enum</span><span class="hl-2">([</span><span class="hl-3">&quot;pending&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;processing&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;shipped&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;delivered&quot;</span><span class="hl-2">]),</span><br/><span class="hl-2">      </span><span class="hl-6">createdAt:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">(),</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Define errors</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">errors</span><span class="hl-2"> = </span><span class="hl-1">createErrorMap</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">ORDER_NOT_FOUND:</span><span class="hl-2"> { </span><span class="hl-6">code:</span><span class="hl-2"> </span><span class="hl-3">&quot;ORDER_NOT_FOUND&quot;</span><span class="hl-2">, </span><span class="hl-6">message:</span><span class="hl-2"> </span><span class="hl-3">&quot;Order not found&quot;</span><span class="hl-2">, </span><span class="hl-6">status:</span><span class="hl-2"> </span><span class="hl-8">404</span><span class="hl-2"> },</span><br/><span class="hl-2">  </span><span class="hl-6">INVALID_ORDER_ID:</span><span class="hl-2"> { </span><span class="hl-6">code:</span><span class="hl-2"> </span><span class="hl-3">&quot;INVALID_ORDER_ID&quot;</span><span class="hl-2">, </span><span class="hl-6">message:</span><span class="hl-2"> </span><span class="hl-3">&quot;Invalid order ID format&quot;</span><span class="hl-2">, </span><span class="hl-6">status:</span><span class="hl-2"> </span><span class="hl-8">400</span><span class="hl-2"> },</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Create the contract</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">orderServiceContract</span><span class="hl-2"> = </span><span class="hl-1">createContract</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">events</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">requests</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-4">export</span><span class="hl-2"> </span><span class="hl-5">type</span><span class="hl-2"> </span><span class="hl-9">OrderServiceContract</span><span class="hl-2"> = </span><span class="hl-5">typeof</span><span class="hl-2"> </span><span class="hl-6">orderServiceContract</span>
</code><button type="button">Copy</button></pre>

<h3 id="transport-adapters" class="tsd-anchor-link">Transport Adapters<a href="#transport-adapters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Transport adapters abstract the underlying communication protocol. Magic Button Messaging comes with an <code>InMemoryTransport</code> for testing, but you can implement your own adapters for HTTP, WebSockets, MQTT, etc.</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">TransportAdapter</span><span class="hl-2">, </span><span class="hl-6">MessageContext</span><span class="hl-2">, </span><span class="hl-6">AuthResult</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Example of a custom WebSocket transport adapter</span><br/><span class="hl-4">export</span><span class="hl-2"> </span><span class="hl-5">class</span><span class="hl-2"> </span><span class="hl-9">WebSocketTransport</span><span class="hl-2"> </span><span class="hl-5">implements</span><span class="hl-2"> </span><span class="hl-9">TransportAdapter</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">socket</span><span class="hl-2">: </span><span class="hl-9">WebSocket</span><span class="hl-2"> | </span><span class="hl-9">null</span><span class="hl-2"> = </span><span class="hl-5">null</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">eventHandlers</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Map</span><span class="hl-2">()</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">requestHandlers</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Map</span><span class="hl-2">()</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">connectionString</span><span class="hl-2"> = </span><span class="hl-3">&quot;&quot;</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-1">connect</span><span class="hl-2">(</span><span class="hl-6">connectionString</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2">): </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">void</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">connectionString</span><span class="hl-2"> = </span><span class="hl-6">connectionString</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">socket</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">WebSocket</span><span class="hl-2">(</span><span class="hl-6">connectionString</span><span class="hl-2">)</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-9">Promise</span><span class="hl-2">((</span><span class="hl-6">resolve</span><span class="hl-2">, </span><span class="hl-6">reject</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">socket</span><span class="hl-2">!.</span><span class="hl-1">onopen</span><span class="hl-2"> = () </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-1">resolve</span><span class="hl-2">()</span><br/><span class="hl-2">      </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">socket</span><span class="hl-2">!.</span><span class="hl-1">onerror</span><span class="hl-2"> = (</span><span class="hl-6">error</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-1">reject</span><span class="hl-2">(</span><span class="hl-6">error</span><span class="hl-2">)</span><br/><span class="hl-2">      </span><br/><span class="hl-2">      </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">socket</span><span class="hl-2">!.</span><span class="hl-1">onmessage</span><span class="hl-2"> = (</span><span class="hl-6">event</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">message</span><span class="hl-2"> = </span><span class="hl-7">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">.</span><span class="hl-6">data</span><span class="hl-2">)</span><br/><span class="hl-2">        </span><br/><span class="hl-2">        </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">type</span><span class="hl-2"> === </span><span class="hl-3">&quot;event&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">          </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">handlers</span><span class="hl-2"> = </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventHandlers</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">event</span><span class="hl-2">)</span><br/><span class="hl-2">          </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">handlers</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-6">handlers</span><span class="hl-2">.</span><span class="hl-1">forEach</span><span class="hl-2">(</span><span class="hl-6">handler</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-1">handler</span><span class="hl-2">(</span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">payload</span><span class="hl-2">, </span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">context</span><span class="hl-2">))</span><br/><span class="hl-2">          }</span><br/><span class="hl-2">        } </span><span class="hl-4">else</span><span class="hl-2"> </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">type</span><span class="hl-2"> === </span><span class="hl-3">&quot;response&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">          </span><span class="hl-0">// Handle responses to requests</span><br/><span class="hl-2">          </span><span class="hl-0">// ...</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    })</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Implement other methods...</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="client-and-server" class="tsd-anchor-link">Client and Server<a href="#client-and-server" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>Client</code> and <code>Server</code> classes provide high-level abstractions for communication:</p>
<pre><code class="typescript"><span class="hl-0">// Server example</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">server</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Server</span><span class="hl-2">(</span><span class="hl-6">transport</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">serverId:</span><span class="hl-2"> </span><span class="hl-3">&quot;order-service&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">version:</span><span class="hl-2"> </span><span class="hl-3">&quot;1.0.0&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">start</span><span class="hl-2">(</span><span class="hl-3">&quot;ws://localhost:8080&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">handleRequest</span><span class="hl-2">(</span><span class="hl-3">&quot;getOrderDetails&quot;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-6">payload</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">, </span><span class="hl-6">clientId</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">orderId</span><span class="hl-2"> } = </span><span class="hl-6">payload</span><br/><span class="hl-2">  </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-6">orderRepository</span><span class="hl-2">.</span><span class="hl-1">findById</span><span class="hl-2">(</span><span class="hl-6">orderId</span><span class="hl-2">)</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Client example</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Client</span><span class="hl-2">(</span><span class="hl-6">transport</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">clientId:</span><span class="hl-2"> </span><span class="hl-3">&quot;web-client&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">autoReconnect:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">connect</span><span class="hl-2">(</span><span class="hl-3">&quot;ws://localhost:8080&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">orderDetails</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;getOrderDetails&quot;</span><span class="hl-2">, { </span><span class="hl-6">orderId:</span><span class="hl-2"> </span><span class="hl-3">&quot;order-123&quot;</span><span class="hl-2"> })</span>
</code><button type="button">Copy</button></pre>

<h3 id="access-control" class="tsd-anchor-link">Access Control<a href="#access-control" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Magic Button Messaging includes a role-based access control system:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">createSystem</span><span class="hl-2">, </span><span class="hl-6">createRole</span><span class="hl-2">, </span><span class="hl-6">createAccessControl</span><span class="hl-2">, </span><span class="hl-6">createActor</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Define a system with resources, actions, and roles</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">orderSystem</span><span class="hl-2"> = </span><span class="hl-1">createSystem</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;order-system&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">resources:</span><span class="hl-2"> [</span><span class="hl-3">&quot;order&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;payment&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;shipment&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">  </span><span class="hl-6">actions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;create&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;read&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;update&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;delete&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">  </span><span class="hl-6">roles:</span><span class="hl-2"> [</span><br/><span class="hl-2">    </span><span class="hl-1">createRole</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;admin&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">permissions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;order:*&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;payment:*&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;shipment:*&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-1">createRole</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;customer&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">permissions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;order:read&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;order:create&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-1">createRole</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;shipping-agent&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">permissions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;order:read&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;shipment:update&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Create an access control instance</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">accessControl</span><span class="hl-2"> = </span><span class="hl-1">createAccessControl</span><span class="hl-2">(</span><span class="hl-6">orderSystem</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Create an actor</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">createActor</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-123&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-3">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">roles:</span><span class="hl-2"> [</span><span class="hl-3">&quot;customer&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Check permissions</span><br/><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">accessControl</span><span class="hl-2">.</span><span class="hl-1">hasPermission</span><span class="hl-2">(</span><span class="hl-6">user</span><span class="hl-2">, </span><span class="hl-3">&quot;order:create&quot;</span><span class="hl-2">)) {</span><br/><span class="hl-2">  </span><span class="hl-0">// User can create orders</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="message-context" class="tsd-anchor-link">Message Context<a href="#message-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Message context allows you to pass metadata with your messages:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">createMessageContext</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Create a message context</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">context</span><span class="hl-2"> = </span><span class="hl-1">createMessageContext</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">source:</span><span class="hl-2"> </span><span class="hl-3">&quot;web-client&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">target:</span><span class="hl-2"> </span><span class="hl-3">&quot;order-service&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">auth:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">token:</span><span class="hl-2"> </span><span class="hl-3">&quot;jwt-token&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">actor:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-123&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-3">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">roles:</span><span class="hl-2"> [</span><span class="hl-3">&quot;customer&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-6">metadata:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">requestId:</span><span class="hl-2"> </span><span class="hl-3">&quot;req-123&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">sessionId:</span><span class="hl-2"> </span><span class="hl-3">&quot;session-456&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-6">traceId:</span><span class="hl-2"> </span><span class="hl-3">&quot;trace-789&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Use the context in a request</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">orderDetails</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;getOrderDetails&quot;</span><span class="hl-2">, { </span><span class="hl-6">orderId:</span><span class="hl-2"> </span><span class="hl-3">&quot;order-123&quot;</span><span class="hl-2"> }, </span><span class="hl-6">context</span><span class="hl-2">)</span>
</code><button type="button">Copy</button></pre>

<h2 id="documentation" class="tsd-anchor-link">Documentation<a href="#documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="api-reference" class="tsd-anchor-link">API Reference<a href="#api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The full API reference is included in the package:</p>
<pre><code class="bash"><span class="hl-0"># View the documentation after installing</span><br/><span class="hl-1">open</span><span class="hl-2"> </span><span class="hl-3">node_modules/@magicbutton.cloud/messaging/docs/api/index.html</span>
</code><button type="button">Copy</button></pre>

<p>You can also view it online at <a href="https://code.magicbutton.cloud">https://code.magicbutton.cloud</a></p>
<h3 id="core-functions" class="tsd-anchor-link">Core Functions<a href="#core-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>createContract(options)</code>: Create a contract with events, requests, and errors</li>
<li><code>createEventMap(schemas)</code>: Create an event schema map</li>
<li><code>createRequestSchemaMap(schemas)</code>: Create a request schema map</li>
<li><code>createErrorMap(errors)</code>: Create an error map</li>
<li><code>createMessageContext(context)</code>: Create a message context</li>
<li><code>createTransportAdapter(transport)</code>: Create a transport adapter</li>
</ul>
<h3 id="access-control-1" class="tsd-anchor-link">Access Control<a href="#access-control-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>createSystem(system)</code>: Create a system definition</li>
<li><code>createRole(role)</code>: Create a role definition</li>
<li><code>createActor(actor)</code>: Create an actor</li>
<li><code>createAccessControl(system)</code>: Create an access control instance</li>
</ul>
<h3 id="classes" class="tsd-anchor-link">Classes<a href="#classes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>Client</code>: Client for sending requests and subscribing to events</li>
<li><code>Server</code>: Server for handling requests and publishing events</li>
<li><code>InMemoryTransport</code>: In-memory transport adapter for testing</li>
</ul>
<h2 id="examples" class="tsd-anchor-link">Examples<a href="#examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="basic-usage" class="tsd-anchor-link">Basic Usage<a href="#basic-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> </span><span class="hl-5">*</span><span class="hl-2"> </span><span class="hl-4">as</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2"> </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;zod&quot;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><br/><span class="hl-2">  </span><span class="hl-6">createContract</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">createEventMap</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">createRequestSchemaMap</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">InMemoryTransport</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">Client</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">Server</span><span class="hl-2"> </span><br/><span class="hl-2">} </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Define contract</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">contract</span><span class="hl-2"> = </span><span class="hl-1">createContract</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">events:</span><span class="hl-2"> </span><span class="hl-1">createEventMap</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">greeting:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({ </span><span class="hl-6">message:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">() }),</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">  </span><span class="hl-6">requests:</span><span class="hl-2"> </span><span class="hl-1">createRequestSchemaMap</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">sayHello:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">requestSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({ </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">() }),</span><br/><span class="hl-2">      </span><span class="hl-6">responseSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({ </span><span class="hl-6">greeting:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">() }),</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Set up server</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">serverTransport</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">InMemoryTransport</span><span class="hl-2">()</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">server</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Server</span><span class="hl-2">(</span><span class="hl-6">serverTransport</span><span class="hl-2">)</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">start</span><span class="hl-2">(</span><span class="hl-3">&quot;memory://hello-service&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">handleRequest</span><span class="hl-2">(</span><span class="hl-3">&quot;sayHello&quot;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-6">payload</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-4">return</span><span class="hl-2"> { </span><span class="hl-6">greeting:</span><span class="hl-2"> </span><span class="hl-3">`Hello, </span><span class="hl-5">${</span><span class="hl-6">payload</span><span class="hl-10">.</span><span class="hl-6">name</span><span class="hl-5">}</span><span class="hl-3">!`</span><span class="hl-2"> }</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Set up client</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">clientTransport</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">InMemoryTransport</span><span class="hl-2">()</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Client</span><span class="hl-2">(</span><span class="hl-6">clientTransport</span><span class="hl-2">)</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">connect</span><span class="hl-2">(</span><span class="hl-3">&quot;memory://hello-service&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Send request</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">response</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;sayHello&quot;</span><span class="hl-2">, { </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;World&quot;</span><span class="hl-2"> })</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">response</span><span class="hl-2">.</span><span class="hl-6">greeting</span><span class="hl-2">) </span><span class="hl-0">// &quot;Hello, World!&quot;</span>
</code><button type="button">Copy</button></pre>

<h3 id="custom-transport" class="tsd-anchor-link">Custom Transport<a href="#custom-transport" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">TransportAdapter</span><span class="hl-2">, </span><span class="hl-6">MessageContext</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-5">class</span><span class="hl-2"> </span><span class="hl-9">HttpTransport</span><span class="hl-2"> </span><span class="hl-5">implements</span><span class="hl-2"> </span><span class="hl-9">TransportAdapter</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">baseUrl</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2"> = </span><span class="hl-3">&quot;&quot;</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">connected</span><span class="hl-2">: </span><span class="hl-9">boolean</span><span class="hl-2"> = </span><span class="hl-5">false</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">eventHandlers</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Map</span><span class="hl-2">()</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">requestHandlers</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Map</span><span class="hl-2">()</span><br/><span class="hl-2">  </span><span class="hl-5">private</span><span class="hl-2"> </span><span class="hl-6">eventSource</span><span class="hl-2">: </span><span class="hl-9">EventSource</span><span class="hl-2"> | </span><span class="hl-9">null</span><span class="hl-2"> = </span><span class="hl-5">null</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-1">connect</span><span class="hl-2">(</span><span class="hl-6">connectionString</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2">): </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">void</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">baseUrl</span><span class="hl-2"> = </span><span class="hl-6">connectionString</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">connected</span><span class="hl-2"> = </span><span class="hl-5">true</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Set up SSE for events</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventSource</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">EventSource</span><span class="hl-2">(</span><span class="hl-3">`</span><span class="hl-5">${</span><span class="hl-5">this</span><span class="hl-10">.</span><span class="hl-6">baseUrl</span><span class="hl-5">}</span><span class="hl-3">/events`</span><span class="hl-2">)</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventSource</span><span class="hl-2">.</span><span class="hl-1">onmessage</span><span class="hl-2"> = (</span><span class="hl-6">event</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">type</span><span class="hl-2">, </span><span class="hl-7">payload</span><span class="hl-2">, </span><span class="hl-7">context</span><span class="hl-2"> } = </span><span class="hl-7">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">.</span><span class="hl-6">data</span><span class="hl-2">)</span><br/><span class="hl-2">      </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">handlers</span><span class="hl-2"> = </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventHandlers</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-6">type</span><span class="hl-2">)</span><br/><span class="hl-2">      </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">handlers</span><span class="hl-2">) {</span><br/><span class="hl-2">        </span><span class="hl-6">handlers</span><span class="hl-2">.</span><span class="hl-1">forEach</span><span class="hl-2">(</span><span class="hl-6">handler</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-1">handler</span><span class="hl-2">(</span><span class="hl-6">payload</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">))</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-1">disconnect</span><span class="hl-2">(): </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">void</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventSource</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventSource</span><span class="hl-2">.</span><span class="hl-1">close</span><span class="hl-2">()</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">connected</span><span class="hl-2"> = </span><span class="hl-5">false</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">getConnectionString</span><span class="hl-2">(): </span><span class="hl-9">string</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">baseUrl</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">isConnected</span><span class="hl-2">(): </span><span class="hl-9">boolean</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">connected</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-1">emit</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2">, </span><span class="hl-6">payload</span><span class="hl-2">: </span><span class="hl-9">any</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">?: </span><span class="hl-9">MessageContext</span><span class="hl-2">): </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">void</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-1">fetch</span><span class="hl-2">(</span><span class="hl-3">`</span><span class="hl-5">${</span><span class="hl-5">this</span><span class="hl-10">.</span><span class="hl-6">baseUrl</span><span class="hl-5">}</span><span class="hl-3">/events`</span><span class="hl-2">, {</span><br/><span class="hl-2">      </span><span class="hl-6">method:</span><span class="hl-2"> </span><span class="hl-3">&#39;POST&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">headers:</span><span class="hl-2"> { </span><span class="hl-3">&#39;Content-Type&#39;</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">&#39;application/json&#39;</span><span class="hl-2"> },</span><br/><span class="hl-2">      </span><span class="hl-6">body:</span><span class="hl-2"> </span><span class="hl-7">JSON</span><span class="hl-2">.</span><span class="hl-1">stringify</span><span class="hl-2">({ </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-6">event</span><span class="hl-2">, </span><span class="hl-6">payload</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2"> }),</span><br/><span class="hl-2">    })</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">on</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2">, </span><span class="hl-1">handler</span><span class="hl-2">: (</span><span class="hl-6">payload</span><span class="hl-2">: </span><span class="hl-9">any</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">: </span><span class="hl-9">MessageContext</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-9">void</span><span class="hl-2">): </span><span class="hl-9">void</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventHandlers</span><span class="hl-2">.</span><span class="hl-1">has</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">)) {</span><br/><span class="hl-2">      </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventHandlers</span><span class="hl-2">.</span><span class="hl-1">set</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">, </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Set</span><span class="hl-2">())</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventHandlers</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">).</span><span class="hl-1">add</span><span class="hl-2">(</span><span class="hl-6">handler</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">off</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2">, </span><span class="hl-1">handler</span><span class="hl-2">: (</span><span class="hl-6">payload</span><span class="hl-2">: </span><span class="hl-9">any</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">: </span><span class="hl-9">MessageContext</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-9">void</span><span class="hl-2">): </span><span class="hl-9">void</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">handlers</span><span class="hl-2"> = </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">eventHandlers</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2">)</span><br/><span class="hl-2">    </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">handlers</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-6">handlers</span><span class="hl-2">.</span><span class="hl-1">delete</span><span class="hl-2">(</span><span class="hl-6">handler</span><span class="hl-2">)</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-6">requestType</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2">, </span><span class="hl-6">payload</span><span class="hl-2">: </span><span class="hl-9">any</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">?: </span><span class="hl-9">MessageContext</span><span class="hl-2">): </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">any</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">response</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-1">fetch</span><span class="hl-2">(</span><span class="hl-3">`</span><span class="hl-5">${</span><span class="hl-5">this</span><span class="hl-10">.</span><span class="hl-6">baseUrl</span><span class="hl-5">}</span><span class="hl-3">/requests/</span><span class="hl-5">${</span><span class="hl-6">requestType</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-2">, {</span><br/><span class="hl-2">      </span><span class="hl-6">method:</span><span class="hl-2"> </span><span class="hl-3">&#39;POST&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">headers:</span><span class="hl-2"> { </span><span class="hl-3">&#39;Content-Type&#39;</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">&#39;application/json&#39;</span><span class="hl-2"> },</span><br/><span class="hl-2">      </span><span class="hl-6">body:</span><span class="hl-2"> </span><span class="hl-7">JSON</span><span class="hl-2">.</span><span class="hl-1">stringify</span><span class="hl-2">({ </span><span class="hl-6">payload</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2"> }),</span><br/><span class="hl-2">    })</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-6">response</span><span class="hl-2">.</span><span class="hl-1">json</span><span class="hl-2">()</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">handleRequest</span><span class="hl-2">(</span><span class="hl-6">requestType</span><span class="hl-2">: </span><span class="hl-9">string</span><span class="hl-2">, </span><span class="hl-1">handler</span><span class="hl-2">: (</span><span class="hl-6">payload</span><span class="hl-2">: </span><span class="hl-9">any</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">: </span><span class="hl-9">MessageContext</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">any</span><span class="hl-2">&gt;): </span><span class="hl-9">void</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-6">requestHandlers</span><span class="hl-2">.</span><span class="hl-1">set</span><span class="hl-2">(</span><span class="hl-6">requestType</span><span class="hl-2">, </span><span class="hl-6">handler</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-1">login</span><span class="hl-2">(</span><span class="hl-6">credentials</span><span class="hl-2">: </span><span class="hl-9">any</span><span class="hl-2">): </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">any</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">response</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-1">fetch</span><span class="hl-2">(</span><span class="hl-3">`</span><span class="hl-5">${</span><span class="hl-5">this</span><span class="hl-10">.</span><span class="hl-6">baseUrl</span><span class="hl-5">}</span><span class="hl-3">/auth/login`</span><span class="hl-2">, {</span><br/><span class="hl-2">      </span><span class="hl-6">method:</span><span class="hl-2"> </span><span class="hl-3">&#39;POST&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">headers:</span><span class="hl-2"> { </span><span class="hl-3">&#39;Content-Type&#39;</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">&#39;application/json&#39;</span><span class="hl-2"> },</span><br/><span class="hl-2">      </span><span class="hl-6">body:</span><span class="hl-2"> </span><span class="hl-7">JSON</span><span class="hl-2">.</span><span class="hl-1">stringify</span><span class="hl-2">(</span><span class="hl-6">credentials</span><span class="hl-2">),</span><br/><span class="hl-2">    })</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-6">response</span><span class="hl-2">.</span><span class="hl-1">json</span><span class="hl-2">()</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-1">logout</span><span class="hl-2">(): </span><span class="hl-9">Promise</span><span class="hl-2">&lt;</span><span class="hl-9">void</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-1">fetch</span><span class="hl-2">(</span><span class="hl-3">`</span><span class="hl-5">${</span><span class="hl-5">this</span><span class="hl-10">.</span><span class="hl-6">baseUrl</span><span class="hl-5">}</span><span class="hl-3">/auth/logout`</span><span class="hl-2">, { </span><span class="hl-6">method:</span><span class="hl-2"> </span><span class="hl-3">&#39;POST&#39;</span><span class="hl-2"> })</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="access-control-example" class="tsd-anchor-link">Access Control Example<a href="#access-control-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><br/><span class="hl-2">  </span><span class="hl-6">createSystem</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">createRole</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">createAccessControl</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">createActor</span><span class="hl-2"> </span><br/><span class="hl-2">} </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Define a system</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">documentSystem</span><span class="hl-2"> = </span><span class="hl-1">createSystem</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;document-system&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">resources:</span><span class="hl-2"> [</span><span class="hl-3">&quot;document&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;folder&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;comment&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">  </span><span class="hl-6">actions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;create&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;read&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;update&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;delete&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;share&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">  </span><span class="hl-6">roles:</span><span class="hl-2"> [</span><br/><span class="hl-2">    </span><span class="hl-1">createRole</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;admin&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">permissions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;document:*&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;folder:*&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;comment:*&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-1">createRole</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;editor&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">permissions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;document:read&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;document:update&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;document:create&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;comment:*&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">      </span><span class="hl-6">extends:</span><span class="hl-2"> [</span><span class="hl-3">&quot;viewer&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-1">createRole</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;viewer&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">permissions:</span><span class="hl-2"> [</span><span class="hl-3">&quot;document:read&quot;</span><span class="hl-2">, </span><span class="hl-3">&quot;comment:read&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Create access control</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">accessControl</span><span class="hl-2"> = </span><span class="hl-1">createAccessControl</span><span class="hl-2">(</span><span class="hl-6">documentSystem</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Create actors</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">adminUser</span><span class="hl-2"> = </span><span class="hl-1">createActor</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-1&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-3">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">roles:</span><span class="hl-2"> [</span><span class="hl-3">&quot;admin&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">editorUser</span><span class="hl-2"> = </span><span class="hl-1">createActor</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-2&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-3">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">roles:</span><span class="hl-2"> [</span><span class="hl-3">&quot;editor&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">viewerUser</span><span class="hl-2"> = </span><span class="hl-1">createActor</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-3&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-3">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">roles:</span><span class="hl-2"> [</span><span class="hl-3">&quot;viewer&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Check permissions</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">accessControl</span><span class="hl-2">.</span><span class="hl-1">hasPermission</span><span class="hl-2">(</span><span class="hl-6">adminUser</span><span class="hl-2">, </span><span class="hl-3">&quot;document:delete&quot;</span><span class="hl-2">)) </span><span class="hl-0">// true</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">accessControl</span><span class="hl-2">.</span><span class="hl-1">hasPermission</span><span class="hl-2">(</span><span class="hl-6">editorUser</span><span class="hl-2">, </span><span class="hl-3">&quot;document:delete&quot;</span><span class="hl-2">)) </span><span class="hl-0">// false</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">accessControl</span><span class="hl-2">.</span><span class="hl-1">hasPermission</span><span class="hl-2">(</span><span class="hl-6">editorUser</span><span class="hl-2">, </span><span class="hl-3">&quot;document:update&quot;</span><span class="hl-2">)) </span><span class="hl-0">// true</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">accessControl</span><span class="hl-2">.</span><span class="hl-1">hasPermission</span><span class="hl-2">(</span><span class="hl-6">viewerUser</span><span class="hl-2">, </span><span class="hl-3">&quot;document:read&quot;</span><span class="hl-2">)) </span><span class="hl-0">// true</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">accessControl</span><span class="hl-2">.</span><span class="hl-1">hasPermission</span><span class="hl-2">(</span><span class="hl-6">viewerUser</span><span class="hl-2">, </span><span class="hl-3">&quot;document:update&quot;</span><span class="hl-2">)) </span><span class="hl-0">// false</span><br/><br/><span class="hl-0">// Get all permissions</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">accessControl</span><span class="hl-2">.</span><span class="hl-1">getPermissions</span><span class="hl-2">(</span><span class="hl-6">editorUser</span><span class="hl-2">))</span><br/><span class="hl-0">// [&quot;document:read&quot;, &quot;document:update&quot;, &quot;document:create&quot;, &quot;comment:read&quot;, &quot;comment:create&quot;, &quot;comment:update&quot;, &quot;comment:delete&quot;]</span>
</code><button type="button">Copy</button></pre>

<h3 id="error-handling" class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-2"> </span><span class="hl-5">*</span><span class="hl-2"> </span><span class="hl-4">as</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2"> </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;zod&quot;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><br/><span class="hl-2">  </span><span class="hl-6">createContract</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">createRequestSchemaMap</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">createErrorMap</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">InMemoryTransport</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">Client</span><span class="hl-2">, </span><br/><span class="hl-2">  </span><span class="hl-6">Server</span><span class="hl-2"> </span><br/><span class="hl-2">} </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&quot;@magicbutton.cloud/messaging&quot;</span><br/><br/><span class="hl-0">// Define contract with errors</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">contract</span><span class="hl-2"> = </span><span class="hl-1">createContract</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">events:</span><span class="hl-2"> {},</span><br/><span class="hl-2">  </span><span class="hl-6">requests:</span><span class="hl-2"> </span><span class="hl-1">createRequestSchemaMap</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">getUserById:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">requestSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({ </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">() }),</span><br/><span class="hl-2">      </span><span class="hl-6">responseSchema:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({ </span><br/><span class="hl-2">        </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">        </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">(),</span><br/><span class="hl-2">        </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">string</span><span class="hl-2">().</span><span class="hl-1">email</span><span class="hl-2">(),</span><br/><span class="hl-2">      }),</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">  </span><span class="hl-6">errors:</span><span class="hl-2"> </span><span class="hl-1">createErrorMap</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">USER_NOT_FOUND:</span><span class="hl-2"> { </span><span class="hl-6">code:</span><span class="hl-2"> </span><span class="hl-3">&quot;USER_NOT_FOUND&quot;</span><span class="hl-2">, </span><span class="hl-6">message:</span><span class="hl-2"> </span><span class="hl-3">&quot;User not found&quot;</span><span class="hl-2">, </span><span class="hl-6">status:</span><span class="hl-2"> </span><span class="hl-8">404</span><span class="hl-2"> },</span><br/><span class="hl-2">    </span><span class="hl-6">INVALID_USER_ID:</span><span class="hl-2"> { </span><span class="hl-6">code:</span><span class="hl-2"> </span><span class="hl-3">&quot;INVALID_USER_ID&quot;</span><span class="hl-2">, </span><span class="hl-6">message:</span><span class="hl-2"> </span><span class="hl-3">&quot;Invalid user ID format&quot;</span><span class="hl-2">, </span><span class="hl-6">status:</span><span class="hl-2"> </span><span class="hl-8">400</span><span class="hl-2"> },</span><br/><span class="hl-2">  }),</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Set up server</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">serverTransport</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">InMemoryTransport</span><span class="hl-2">()</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">server</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Server</span><span class="hl-2">(</span><span class="hl-6">serverTransport</span><span class="hl-2">)</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">start</span><span class="hl-2">(</span><span class="hl-3">&quot;memory://user-service&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Mock user database</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">users</span><span class="hl-2"> = [</span><br/><span class="hl-2">  { </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-1&quot;</span><span class="hl-2">, </span><span class="hl-6">name:</span><span class="hl-2"> </span><span class="hl-3">&quot;John Doe&quot;</span><span class="hl-2">, </span><span class="hl-6">email:</span><span class="hl-2"> </span><span class="hl-3">&quot;john@example.com&quot;</span><span class="hl-2"> },</span><br/><span class="hl-2">]</span><br/><br/><span class="hl-6">server</span><span class="hl-2">.</span><span class="hl-1">handleRequest</span><span class="hl-2">(</span><span class="hl-3">&quot;getUserById&quot;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-6">payload</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">id</span><span class="hl-2"> } = </span><span class="hl-6">payload</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Validate ID format</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-6">id</span><span class="hl-2">.</span><span class="hl-1">startsWith</span><span class="hl-2">(</span><span class="hl-3">&quot;user-&quot;</span><span class="hl-2">)) {</span><br/><span class="hl-2">    </span><span class="hl-4">throw</span><span class="hl-2"> </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-3">&quot;INVALID_USER_ID&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Find user</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-6">users</span><span class="hl-2">.</span><span class="hl-1">find</span><span class="hl-2">(</span><span class="hl-6">u</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-6">u</span><span class="hl-2">.</span><span class="hl-6">id</span><span class="hl-2"> === </span><span class="hl-6">id</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-6">user</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-4">throw</span><span class="hl-2"> </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-3">&quot;USER_NOT_FOUND&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-6">user</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Set up client</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">clientTransport</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">InMemoryTransport</span><span class="hl-2">()</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Client</span><span class="hl-2">(</span><span class="hl-6">clientTransport</span><span class="hl-2">)</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">connect</span><span class="hl-2">(</span><span class="hl-3">&quot;memory://user-service&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// Successful request</span><br/><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;getUserById&quot;</span><span class="hl-2">, { </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-1&quot;</span><span class="hl-2"> })</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&quot;User found:&quot;</span><span class="hl-2">, </span><span class="hl-6">user</span><span class="hl-2">)</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-3">&quot;Error:&quot;</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2">)</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Error handling - User not found</span><br/><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;getUserById&quot;</span><span class="hl-2">, { </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;user-999&quot;</span><span class="hl-2"> })</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&quot;User found:&quot;</span><span class="hl-2">, </span><span class="hl-6">user</span><span class="hl-2">)</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-3">&quot;Error:&quot;</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">) </span><span class="hl-0">// &quot;USER_NOT_FOUND&quot;</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Error handling - Invalid ID</span><br/><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&quot;getUserById&quot;</span><span class="hl-2">, { </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-3">&quot;invalid-id&quot;</span><span class="hl-2"> })</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&quot;User found:&quot;</span><span class="hl-2">, </span><span class="hl-6">user</span><span class="hl-2">)</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-3">&quot;Error:&quot;</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">) </span><span class="hl-0">// &quot;INVALID_USER_ID&quot;</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="react-integration" class="tsd-anchor-link">React Integration<a href="#react-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="tsx"><span class="hl-4">import</span><span class="hl-2"> </span><span class="hl-6">React</span><span class="hl-2">, { </span><span class="hl-6">useState</span><span class="hl-2">, </span><span class="hl-6">useEffect</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&#39;react&#39;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">Client</span><span class="hl-2">, </span><span class="hl-6">InMemoryTransport</span><span class="hl-2">, </span><span class="hl-6">createMessageContext</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&#39;@magicbutton.cloud/messaging&#39;</span><br/><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-6">userServiceContract</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&#39;./contract&#39;</span><br/><br/><span class="hl-0">// Create a client</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">transport</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">InMemoryTransport</span><span class="hl-2">()</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-1">Client</span><span class="hl-2">(</span><span class="hl-6">transport</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">clientId:</span><span class="hl-2"> </span><span class="hl-3">&quot;web-client&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">autoReconnect:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2">,</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// React hook for using the messaging client</span><br/><span class="hl-5">function</span><span class="hl-2"> </span><span class="hl-1">useMessagingClient</span><span class="hl-2">() {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> [</span><span class="hl-7">isConnected</span><span class="hl-2">, </span><span class="hl-7">setIsConnected</span><span class="hl-2">] = </span><span class="hl-1">useState</span><span class="hl-2">(</span><span class="hl-5">false</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> [</span><span class="hl-7">error</span><span class="hl-2">, </span><span class="hl-7">setError</span><span class="hl-2">] = </span><span class="hl-1">useState</span><span class="hl-2">&lt;</span><span class="hl-9">Error</span><span class="hl-2"> | </span><span class="hl-9">null</span><span class="hl-2">&gt;(</span><span class="hl-5">null</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">useEffect</span><span class="hl-2">(() </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// Connect to the server</span><br/><span class="hl-2">    </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">connect</span><span class="hl-2">(</span><span class="hl-3">&quot;memory://user-service&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">      .</span><span class="hl-1">then</span><span class="hl-2">(() </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-1">setIsConnected</span><span class="hl-2">(</span><span class="hl-5">true</span><span class="hl-2">))</span><br/><span class="hl-2">      .</span><span class="hl-1">catch</span><span class="hl-2">(</span><span class="hl-6">err</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-1">setError</span><span class="hl-2">(</span><span class="hl-6">err</span><span class="hl-2">))</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Listen for status changes</span><br/><span class="hl-2">    </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">unsubscribe</span><span class="hl-2"> = </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">onStatusChange</span><span class="hl-2">((</span><span class="hl-6">status</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-1">setIsConnected</span><span class="hl-2">(</span><span class="hl-6">status</span><span class="hl-2"> === </span><span class="hl-3">&#39;connected&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">    })</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Clean up</span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2"> () </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-1">unsubscribe</span><span class="hl-2">()</span><br/><span class="hl-2">      </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">disconnect</span><span class="hl-2">()</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }, [])</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-4">return</span><span class="hl-2"> { </span><span class="hl-6">client</span><span class="hl-2">, </span><span class="hl-6">isConnected</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2"> }</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Example component using the hook</span><br/><span class="hl-5">function</span><span class="hl-2"> </span><span class="hl-1">UserProfile</span><span class="hl-2">({ </span><span class="hl-6">userId</span><span class="hl-2"> }) {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">client</span><span class="hl-2">, </span><span class="hl-7">isConnected</span><span class="hl-2">, </span><span class="hl-7">error</span><span class="hl-2"> } = </span><span class="hl-1">useMessagingClient</span><span class="hl-2">()</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> [</span><span class="hl-7">user</span><span class="hl-2">, </span><span class="hl-7">setUser</span><span class="hl-2">] = </span><span class="hl-1">useState</span><span class="hl-2">(</span><span class="hl-5">null</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> [</span><span class="hl-7">loading</span><span class="hl-2">, </span><span class="hl-7">setLoading</span><span class="hl-2">] = </span><span class="hl-1">useState</span><span class="hl-2">(</span><span class="hl-5">true</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> [</span><span class="hl-7">userError</span><span class="hl-2">, </span><span class="hl-7">setUserError</span><span class="hl-2">] = </span><span class="hl-1">useState</span><span class="hl-2">(</span><span class="hl-5">null</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">useEffect</span><span class="hl-2">(() </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-6">isConnected</span><span class="hl-2">) </span><span class="hl-4">return</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-1">setLoading</span><span class="hl-2">(</span><span class="hl-5">true</span><span class="hl-2">)</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Create context with auth info</span><br/><span class="hl-2">    </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">context</span><span class="hl-2"> = </span><span class="hl-1">createMessageContext</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">auth:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-6">token:</span><span class="hl-2"> </span><span class="hl-6">localStorage</span><span class="hl-2">.</span><span class="hl-1">getItem</span><span class="hl-2">(</span><span class="hl-3">&#39;token&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    })</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Fetch user data</span><br/><span class="hl-2">    </span><span class="hl-6">client</span><span class="hl-2">.</span><span class="hl-1">request</span><span class="hl-2">(</span><span class="hl-3">&#39;getUserById&#39;</span><span class="hl-2">, { </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">userId</span><span class="hl-2"> }, </span><span class="hl-6">context</span><span class="hl-2">)</span><br/><span class="hl-2">      .</span><span class="hl-1">then</span><span class="hl-2">(</span><span class="hl-6">userData</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-1">setUser</span><span class="hl-2">(</span><span class="hl-6">userData</span><span class="hl-2">)</span><br/><span class="hl-2">        </span><span class="hl-1">setLoading</span><span class="hl-2">(</span><span class="hl-5">false</span><span class="hl-2">)</span><br/><span class="hl-2">      })</span><br/><span class="hl-2">      .</span><span class="hl-1">catch</span><span class="hl-2">(</span><span class="hl-6">err</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-1">setUserError</span><span class="hl-2">(</span><span class="hl-6">err</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">)</span><br/><span class="hl-2">        </span><span class="hl-1">setLoading</span><span class="hl-2">(</span><span class="hl-5">false</span><span class="hl-2">)</span><br/><span class="hl-2">      })</span><br/><span class="hl-2">  }, [</span><span class="hl-6">userId</span><span class="hl-2">, </span><span class="hl-6">isConnected</span><span class="hl-2">])</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-6">isConnected</span><span class="hl-2">) </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-11">&lt;</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><span class="hl-2">Connecting to server...</span><span class="hl-11">&lt;/</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-11">&lt;</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><span class="hl-2">Connection error: </span><span class="hl-5">{</span><span class="hl-6">error</span><span class="hl-10">.</span><span class="hl-6">message</span><span class="hl-5">}</span><span class="hl-11">&lt;/</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">loading</span><span class="hl-2">) </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-11">&lt;</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><span class="hl-2">Loading user data...</span><span class="hl-11">&lt;/</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-6">userError</span><span class="hl-2">) </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-11">&lt;</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><span class="hl-2">Error loading user: </span><span class="hl-5">{</span><span class="hl-6">userError</span><span class="hl-5">}</span><span class="hl-11">&lt;/</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-4">return</span><span class="hl-2"> (</span><br/><span class="hl-2">    </span><span class="hl-11">&lt;</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><br/><span class="hl-2">      </span><span class="hl-11">&lt;</span><span class="hl-12">h1</span><span class="hl-11">&gt;</span><span class="hl-5">{</span><span class="hl-6">user</span><span class="hl-10">.</span><span class="hl-6">name</span><span class="hl-5">}</span><span class="hl-11">&lt;/</span><span class="hl-12">h1</span><span class="hl-11">&gt;</span><br/><span class="hl-2">      </span><span class="hl-11">&lt;</span><span class="hl-12">p</span><span class="hl-11">&gt;</span><span class="hl-2">Email: </span><span class="hl-5">{</span><span class="hl-6">user</span><span class="hl-10">.</span><span class="hl-6">email</span><span class="hl-5">}</span><span class="hl-11">&lt;/</span><span class="hl-12">p</span><span class="hl-11">&gt;</span><br/><span class="hl-2">      </span><span class="hl-11">&lt;</span><span class="hl-12">button</span><span class="hl-2"> </span><span class="hl-13">onClick</span><span class="hl-2">=</span><span class="hl-5">{</span><span class="hl-10">() </span><span class="hl-5">=&gt;</span><span class="hl-10"> {</span><br/><span class="hl-10">        </span><span class="hl-6">client</span><span class="hl-10">.</span><span class="hl-1">request</span><span class="hl-10">(</span><span class="hl-3">&#39;updateUser&#39;</span><span class="hl-10">, {</span><br/><span class="hl-10">          </span><span class="hl-6">id:</span><span class="hl-10"> </span><span class="hl-6">userId</span><span class="hl-10">,</span><br/><span class="hl-10">          </span><span class="hl-6">name:</span><span class="hl-10"> </span><span class="hl-6">user</span><span class="hl-10">.</span><span class="hl-6">name</span><span class="hl-10"> </span><span class="hl-2">+</span><span class="hl-10"> </span><span class="hl-3">&#39; (Updated)&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">        })</span><br/><span class="hl-10">        .</span><span class="hl-1">then</span><span class="hl-10">(</span><span class="hl-6">updatedUser</span><span class="hl-10"> </span><span class="hl-5">=&gt;</span><span class="hl-10"> </span><span class="hl-1">setUser</span><span class="hl-10">(</span><span class="hl-6">updatedUser</span><span class="hl-10">))</span><br/><span class="hl-10">      }</span><span class="hl-5">}</span><span class="hl-11">&gt;</span><br/><span class="hl-2">        Update Name</span><br/><span class="hl-2">      </span><span class="hl-11">&lt;/</span><span class="hl-12">button</span><span class="hl-11">&gt;</span><br/><span class="hl-2">    </span><span class="hl-11">&lt;/</span><span class="hl-12">div</span><span class="hl-11">&gt;</span><br/><span class="hl-2">  )</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="contributing" class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We welcome contributions to Magic Button Messaging! Please see our <a href="CONTRIBUTING.md">contributing guidelines</a> for more information.</p>
<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Magic Button Messaging is licensed under the MIT License. See the <a href="LICENSE">LICENSE</a> file for more information.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#magic-button-messaging"><span>Magic <wbr/>Button <wbr/>Messaging</span></a><ul><li><a href="#table-of-contents"><span>Table of <wbr/>Contents</span></a></li><li><a href="#features"><span>Features</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#quick-start"><span>Quick <wbr/>Start</span></a></li><li><ul><li><a href="#define-your-contract"><span>Define <wbr/>Your <wbr/>Contract</span></a></li><li><a href="#server-implementation"><span>Server <wbr/>Implementation</span></a></li><li><a href="#client-implementation"><span>Client <wbr/>Implementation</span></a></li></ul></li><li><a href="#core-concepts"><span>Core <wbr/>Concepts</span></a></li><li><ul><li><a href="#contracts"><span>Contracts</span></a></li><li><a href="#transport-adapters"><span>Transport <wbr/>Adapters</span></a></li><li><a href="#client-and-server"><span>Client and <wbr/>Server</span></a></li><li><a href="#access-control"><span>Access <wbr/>Control</span></a></li><li><a href="#message-context"><span>Message <wbr/>Context</span></a></li></ul></li><li><a href="#documentation"><span>Documentation</span></a></li><li><ul><li><a href="#api-reference"><span>API <wbr/>Reference</span></a></li><li><a href="#core-functions"><span>Core <wbr/>Functions</span></a></li><li><a href="#access-control-1"><span>Access <wbr/>Control</span></a></li><li><a href="#classes"><span>Classes</span></a></li></ul></li><li><a href="#examples"><span>Examples</span></a></li><li><ul><li><a href="#basic-usage"><span>Basic <wbr/>Usage</span></a></li><li><a href="#custom-transport"><span>Custom <wbr/>Transport</span></a></li><li><a href="#access-control-example"><span>Access <wbr/>Control <wbr/>Example</span></a></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li><li><a href="#react-integration"><span>React <wbr/>Integration</span></a></li></ul></li><li><a href="#contributing"><span>Contributing</span></a></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/magicbutton.cloud/messaging" class="tsd-nav-link">GitHub</a><a href="https://code.magicbutton.cloud" class="tsd-nav-link">Documentation</a></nav><nav class="tsd-navigation"><a href="modules.html">Magic Button Messaging - v1.0.7</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
